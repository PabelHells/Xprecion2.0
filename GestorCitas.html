<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Citas - XPRECION</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<header>
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <img src="logo.jpg" alt="XPRECION Logo" style="width: 40px;">
        XPRECION
      </a>
    </div>
  </nav>
</header>

<main class="container mt-5 pt-5">
  <!-- Formulario para registrar al paciente -->
  <div class="card mx-auto mb-4">
    <div class="card-header text-center">
      <h2>Registro del Paciente</h2>
    </div>
    <div class="card-body">
      <form id="formPaciente" action="php/GuardarPaciente.php" method="POST">
        <div class="mb-3">
          <label for="patientName" class="form-label">Nombre del Paciente</label>
          <input type="text" id="patientName" name="patientName" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="birthDate" class="form-label">Fecha de Nacimiento</label>
          <input type="date" id="birthDate" name="birthDate" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Guardar Datos</button>
      </form>
    </div>
  </div>

  <!-- Formulario para gestionar citas -->
  <div class="card mx-auto">
    <div class="card-header text-center">
      <h2>Gestión de Citas Médicas</h2>
    </div>
    <div class="card-body">
      <form id="appointmentForm" action="php/GuardarCitas.php" method="POST">
        <div class="mb-3">
          <label for="specialty" class="form-label">Especialidad</label>
          <select id="specialty" name="specialty" class="form-select" required>
            <option value="" disabled selected>Seleccione una especialidad</option>
            <option value="1">Tomografía Axial Multicorte</option>
            <option value="3">Angiotomografía</option>
            <option value="4">Ultrasonidos</option>
            <option value="5">Elastografía hepática</option>
            <option value="6">Musculoesquelético</option>
            <option value="7">Biopsias</option>
            <option value="10">Rayos X</option>
            <option value="11">Estudios contrastados</option>tion>
          </select>
        </div>
        <div class="mb-3">
          <label for="year" class="form-label">Año</label>
          <input type="number" id="year" class="form-control" value="2024" min="2024" max="2030" onchange="updateMonths()" required>
        </div>
        <div class="mb-3">
          <label for="month" class="form-label">Mes</label>
          <select id="month" class="form-select" onchange="updateCalendar()" required>
            <option value="" disabled selected>Seleccione un mes</option>
          </select>
        </div>
        <div id="calendarContainer" class="mt-4"></div>
        <div class="mt-3">
          <p><strong>Fecha Seleccionada:</strong> <span id="selectedDate">Ninguna</span></p>
        </div>
        <input type="hidden" id="appointmentDate" name="appointmentDate">
        <input type="hidden" id="patientId" name="patientId" value="1"> <!-- ID ficticio -->
        <button type="submit" class="btn btn-success w-100">Guardar Cita</button>
      </form>
    </div>
  </div>
</main>
<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const minDate = new Date('2024-12-01'); // Fecha mínima permitida
  const months = [
    "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
    "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
  ];

  function updateMonths() {
    const year = parseInt(document.getElementById('year').value);
    const monthSelect = document.getElementById('month');
    monthSelect.innerHTML = '<option value="" disabled selected>Seleccione un mes</option>';
    
    if (year === 2024) {
      const option = document.createElement('option');
      option.value = 11; // Diciembre
      option.textContent = months[11];
      monthSelect.appendChild(option);
    } else if (year > 2024) {
      months.forEach((month, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = month;
        monthSelect.appendChild(option);
      });
    }
  }

  function updateCalendar() {
    const calendarContainer = document.getElementById('calendarContainer');
    const month = document.getElementById('month').value;
    const year = document.getElementById('year').value;

    if (month === "" || year === "") return;

    const daysInMonth = new Date(year, parseInt(month) + 1, 0).getDate();
    const firstDay = new Date(year, month, 1).getDay();

    let table = `<table class="table table-bordered text-center"><thead><tr>
      <th>Dom</th><th>Lun</th><th>Mar</th><th>Mié</th><th>Jue</th><th>Vie</th><th>Sáb</th>
    </tr></thead><tbody><tr>`;

    for (let i = 0; i < firstDay; i++) {
      table += '<td></td>';
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const date = new Date(year, month, day);
      const formattedDate = `${year}-${String(parseInt(month) + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

      if (date >= minDate) {
        table += `<td data-date="${formattedDate}" class="calendar-day">${day}</td>`;
      } else {
        table += `<td class="text-muted">${day}</td>`;
      }

      if ((firstDay + day) % 7 === 0) table += '</tr><tr>';
    }

    table += '</tr></tbody></table>';
    calendarContainer.innerHTML = table;

    document.querySelectorAll('.calendar-day').forEach(day => {
      day.addEventListener('click', function () {
        const selectedDate = new Date(this.getAttribute('data-date'));
        if (selectedDate < minDate) {
          alert('¡Fecha no válida! Por favor, selecciona una fecha a partir de diciembre de 2024.');
        } else {
          document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected-day'));
          this.classList.add('selected-day');
          document.getElementById('selectedDate').innerText = this.getAttribute('data-date');
          document.getElementById('appointmentDate').value = this.getAttribute('data-date');
        }
      });
    });
  }

  const style = document.createElement('style');
  style.textContent = `
    .calendar-day { cursor: pointer; }
    .calendar-day.selected-day { background-color: #0d6efd; color: #fff; }
  `;
  document.head.appendChild(style);

  function saveAppointment(event) {
    event.preventDefault();
    const appointmentDate = document.getElementById('appointmentDate').value;
    console.log('Cita guardada:', { appointmentDate });
  }

  // Inicialización de opciones al cargar la página
  updateMonths();
</script>
</body>
</html>